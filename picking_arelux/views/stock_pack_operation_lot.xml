<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="picking_arelux_view_pack_operation_lot_form" model="ir.ui.view">
        <field name="name">picking_arelux_view_stock_production_lot_tree</field>
        <field name="model">stock.pack.operation</field>
        <field name="inherit_id" ref="stock.view_pack_operation_lot_form"/>
        <field name="arch" type="xml">
            <field name="product_id" position="after">
                <field name="picking_id_type_code" invisible="1" />
            </field>
            <field name="pack_lot_ids" position="replace">
                <div attrs="{'invisible': [('state','=', 'done')]}">
                    <field name="pack_lot_ids_incoming" nolabel="1" attrs="{'invisible': [('picking_id_type_code','!=','incoming')]}">
                        <tree editable="bottom" decoration-success="qty_todo==qty" decoration-danger="(qty_todo &gt; 0) and (qty&gt;qty_todo)">
                            <field name="custom_field" invisible="1" />                      
                            <field name="lot_name" invisible="not context.get('only_create', False)"/>
                            <field name="lot_id_picking_incoming" domain="[('product_id','=', parent.product_id)]" />
                            <field name="lot_it_picking_incoming_product_qty" />
                            <field name="qty_todo" invisible="not context.get('show_reserved') or context.get('serial') or context.get('state_done')" readonly="1"/>
                            <field name="qty" invisible="context.get('serial')"/>
                            <button name="do_minus" type="object" icon="fa-minus-square" attrs="{'invisible': [('qty', '&lt;=', 0.99)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <button name="do_plus" type="object" icon="fa-plus-square" attrs="{'invisible': [('plus_visible', '=', False)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <field name="plus_visible" invisible="1"/>
                        </tree>
                    </field>
                    <field name="pack_lot_ids_outgoing" nolabel="1" attrs="{'invisible': [('picking_id_type_code','!=','outgoing')]}">
                        <tree editable="bottom" decoration-success="qty_todo==qty" decoration-danger="(qty_todo &gt; 0) and (qty&gt;qty_todo)">
                            <field name="custom_field" invisible="1" />
                            <field name="lot_name" invisible="not context.get('only_create', False)"/>
                            <field name="lot_id_picking_outgoing" domain="[('product_id','=', parent.product_id),('product_qty_store', '>=', parent.product_qty)]" />
                            <field name="lot_it_picking_outgoing_product_qty" />
                            <field name="qty_todo" invisible="not context.get('show_reserved') or context.get('serial') or context.get('state_done')" readonly="1"/>
                            <field name="qty" invisible="context.get('serial')"/>
                            <button name="do_minus" type="object" icon="fa-minus-square" attrs="{'invisible': [('qty', '&lt;=', 0.99)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <button name="do_plus" type="object" icon="fa-plus-square" attrs="{'invisible': [('plus_visible', '=', False)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <field name="plus_visible" invisible="1"/>
                        </tree>
                    </field>
                    <field name="pack_lot_ids_internal" nolabel="1" attrs="{'invisible': [('picking_id_type_code','!=','internal')]}">
                        <tree editable="bottom" decoration-success="qty_todo==qty" decoration-danger="(qty_todo &gt; 0) and (qty&gt;qty_todo)">
                            <field name="custom_field" invisible="1" />
                            <field name="lot_name" invisible="not context.get('only_create', False)"/>
                            <field name="lot_id_picking_internal" domain="[('product_id','=', parent.product_id),('product_qty_store', '>=', 0)]" />
                            <field name="lot_it_picking_internal_product_qty" />
                            <field name="qty_todo" invisible="not context.get('show_reserved') or context.get('serial') or context.get('state_done')" readonly="1"/>
                            <field name="qty" invisible="context.get('serial')"/>
                            <button name="do_minus" type="object" icon="fa-minus-square" attrs="{'invisible': [('qty', '&lt;=', 0.99)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <button name="do_plus" type="object" icon="fa-plus-square" attrs="{'invisible': [('plus_visible', '=', False)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <field name="plus_visible" invisible="1"/>
                        </tree>
                    </field>                
                </div>
                <div attrs="{'invisible': [('state','!=', 'done')]}">
                    <field name="pack_lot_ids" nolabel="1" attrs="{'readonly': [('state', '=', 'done')]}">
                        <tree editable="bottom" decoration-success="qty_todo==qty" decoration-danger="(qty_todo &gt; 0) and (qty&gt;qty_todo)">
                            <field name="custom_field" invisible="1" />
                            <field name="lot_name" invisible="not context.get('only_create', False)"/>
                            <field name="lot_id" invisible="context.get('only_create', False)" domain="[('product_id','=', parent.product_id)]" context="{'default_product_id': parent.product_id, 'active_pack_operation': parent.id}"/>
                            <field name="qty_todo" invisible="not context.get('show_reserved') or context.get('serial') or context.get('state_done')" readonly="1"/>
                            <field name="qty" invisible="context.get('serial')"/>
                            <button name="do_minus" type="object" icon="fa-minus-square" attrs="{'invisible': [('qty', '&lt;=', 0.99)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <button name="do_plus" type="object" icon="fa-plus-square" attrs="{'invisible': [('plus_visible', '=', False)]}" invisible="not context.get('show_reserved') or context.get('state_done')"/>
                            <field name="plus_visible" invisible="1"/>
                        </tree>
                    </field>
                </div>                                                                                
            </field>                                                                                                        
        </field>
    </record>           
</odoo>
